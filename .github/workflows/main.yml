name: Unity CI/CD - Main push (Format check, Test Runner)

on:
  push:
    branches: [ "main" ]
    
jobs:
  # release:
  #   needs: auto-tag
  #   runs-on: ubuntu-latest
  #   steps:
  #     - name: Download Build Artifact
  #       uses: actions/download-artifact@v3
  #       with:
  #         name: Build

  #     - name: Create Release
  #       id: create_release
  #       uses: actions/create-release@v1
  #       env:
  #         GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
  #       with:
  #         tag_name: ${{ github.ref_name }}
  #         release_name: Release ${{ github.ref_name }}
  #         draft: false
  #         prerelease: false
  call-format:
    name: Format check ğŸ—’ï¸
    uses: ./.github/workflows/re-format.yml
  call-tags:
    needs: call-format
    name: Version tag ğŸ·ï¸
    uses: ./.github/workflows/re-tag.yml
  call-tests:
    needs: call-tags
    name: Test runner ğŸ§ª
    uses: ./.github/workflows/re-tests.yml
    secrets: inherit
  call-build:
    needs: call-tests
    name: Build project ğŸ—ï¸
    uses: ./.github/workflows/re-build.yml
    secrets: inherit
  release:
    needs: call-build
    runs-on: ubuntu-latest
    name: Release project ğŸ“¨
    steps:
      - name: Releasing...
        uses: konfer-be/action-create-release-from-tag@v1.0.2
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
      
