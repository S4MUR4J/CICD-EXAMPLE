name: Unity CI/CD - Main push (Format check, Test Runner)

on:
  push:
    branches: [ "main" ]
    
jobs:
  # auto-tag:
  #   needs: build
  #   runs-on: ubuntu-latest
  #   steps:
  #     - name: Checkout
  #       uses: actions/checkout@v2

  #     - name: Set up Git
  #       run: |
  #         git config --global user.name 'github-actions'
  #         git config --global user.email 'github-actions@github.com'

  #     - name: Fetch Tags
  #       run: git fetch --tags

  #     - name: Calculate new tag
  #       id: new_tag
  #       run: |
  #         # Pobierz tagi i posortuj je wersyjnie
  #         TAG=$(git tag --sort=-v:refname | head -n 1)
          
  #         # Ustal nowy numer wersji
  #         if [ -z "$TAG" ]; then
  #           NEW_TAG="0.0"
  #         else
  #           NEW_TAG=$(echo $TAG | awk -F. '{$NF = $NF + 1; OFS="."; print $0}')
  #         fi
          
  #         # Ustaw zmiennÄ… wyjÅ›ciowÄ… dla kolejnych krokÃ³w
  #         echo "::set-output name=tag::$NEW_TAG"

  #     - name: Create and Push Tag
  #       if: steps.new_tag.outputs.tag
  #       run: |
  #         NEW_TAG=${{ steps.new_tag.outputs.tag }}
  #         git tag $NEW_TAG
  #         git push origin $NEW_TAG
  # release:
  #   needs: auto-tag
  #   runs-on: ubuntu-latest
  #   steps:
  #     - name: Download Build Artifact
  #       uses: actions/download-artifact@v3
  #       with:
  #         name: Build

  #     - name: Create Release
  #       id: create_release
  #       uses: actions/create-release@v1
  #       env:
  #         GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
  #       with:
  #         tag_name: ${{ github.ref_name }}
  #         release_name: Release ${{ github.ref_name }}
  #         draft: false
  #         prerelease: false
  call-format:
    name: Format check ğŸ—’ï¸
    uses: ./.github/workflows/re-format.yml
  # call-tests:
  #   needs: call-format
  #   name: Test runner ğŸ§ª
  #   uses: ./.github/workflows/re-tests.yml
  #   secrets: inherit
  call-tags:
    needs: call-format
    name: Version tag ğŸ·ï¸
    uses: ./.github/workflows/re-tag.yml
  # call-build:
  #   needs: call-tags
  #   name: Build project ğŸ—ï¸
  #   uses: ./.github/workflows/re-build.yml
  #   secrets: inherit
      
